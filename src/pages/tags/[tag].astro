---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogCard from '../../components/partial/BlogCard.astro';
import Scrollable from '../../components/partial/Scrollable.astro';

export async function getStaticPaths() {
  const allPosts = Object.values(import.meta.glob('../../content/blog/*.md', { eager: true }));

  const uniqueTags = [... new Set(allPosts.map((post: any) => post.frontmatter.tags).flat())];

  return uniqueTags.map((tag) => {
    const filteredPosts = allPosts.filter((post: any) => post.frontmatter.tags.includes(tag));
    return {
      params: { tag },
      props: { posts: filteredPosts },
    };
  });
}

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<BaseLayout pageTitle={tag}>
  <div class="flex flex-row justify-between items-center font-bold text-black dark:text-light text-center mb-8">
    <div class="headline border-b-2 rounded-b-md pb-2">{tag}</div>
  </div>

<Scrollable>
  <div class="flex flex-wrap justify-center gap-15 mb-20">
    {posts.map((post: any) => <BlogCard 
      url={post.url}
      title={post.frontmatter.title}
      id={post.id}
      description={post.frontmatter.description}
      pubDate={post.frontmatter.pubDate}
    />)}
  </div>
</Scrollable>
</BaseLayout>